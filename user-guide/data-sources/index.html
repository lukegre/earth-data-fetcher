<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Defining Data Sources - Earth Data Fetcher</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Defining Data Sources";
        var mkdocs_page_input_path = "user-guide/data-sources.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Earth Data Fetcher
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Defining Data Sources</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#basic-configuration">Basic configuration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#accepted-fields">Accepted Fields</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configurations-for-supported-protocols">Configurations for supported protocols</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#httphttpsftps3">HTTP/HTTPS/FTP/S3</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#thredds-datasets">THREDDS datasets</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cmems-datasets">CMEMS datasets</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oceansoda-sources/">OceanSODA-ETHZv2 sources</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/download_https/">DownloaderFsspec</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/download_xarray/">DownloaderXarray</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../contributing/">Contributing</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Earth Data Fetcher</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Guide</li>
      <li class="breadcrumb-item active">Defining Data Sources</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="defining-data-sources">Defining Data Sources<a class="headerlink" href="#defining-data-sources" title="Permanent link">&para;</a></h1>
<p>Earth Data Fetcher supports various gridded data sources and protocols. Data are saved as netCDF files</p>
<p>The following data sources are currently supported:</p>
<ul>
<li><a href="#httphttpsftps3">HTTP/HTTPS/FTP/S3</a></li>
<li><a href="#thredds-datasets">THREDDS datasets</a></li>
<li><a href="#cmems-datasets">CMEMS datasets</a></li>
</ul>
<h2 id="basic-configuration">Basic configuration<a class="headerlink" href="#basic-configuration" title="Permanent link">&para;</a></h2>
<p>Each data source is defined as a top-level entry in the YAML file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">dataset_name</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">        </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Dataset</span><span class="nv"> </span><span class="s">Title&#39;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;v1.0&#39;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nt">storage_options</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">        </span><span class="nt">cache_storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">path/to/storage/{t:%Y}/</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="nt">same_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.com/data_{t:%Y%m%d}.nc</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="nt">variables</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">        </span><span class="nt">variable_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output_name</span>
</code></pre></div>
<h3 id="accepted-fields">Accepted Fields<a class="headerlink" href="#accepted-fields" title="Permanent link">&para;</a></h3>
<p>Bold values are required, italic are required for some sources.</p>
<ul>
<li><strong><code>url</code></strong>: The URL template for accessing the data</li>
<li><strong><code>storage_options</code></strong>: Configuration for local storage that is passed to <code>fsspec</code> - can add more options if login is required<ul>
<li><strong><code>cache_storage</code></strong>: Path template for storing downloaded files. For <code>fsspec</code>-based storage, only the directory is required. For <code>xarray</code>-based storage, the full path is required. Supports using string formatting with time denoted by <code>{t:%Y%m%d}</code> where <code>%Y</code> is the year, <code>%m</code> is the month, and <code>%d</code> is the day. Any top-level and metadata arguments will be passed to the string formatting.</li>
</ul>
</li>
<li><em><code>variables</code></em>: required for THREDDS and CMEMS datasets.<ul>
<li>the <code>variable_name: output_name</code>. The variables are currently not renamed, but allows for renaming further down the pipeline. </li>
</ul>
</li>
<li><em><code>time</code></em>: Configuration for the time range of the dataset - required for file-based sources (FTP, HTTP, HTTPS, S3)<ul>
<li><code>start</code>: Start date of the dataset (YYYY-MM-DD)</li>
<li><code>end</code>: End date of the dataset (YYYY-MM-DD)</li>
<li><code>freq</code>: Frequency of the dataset, with support for <code>n[DMY]</code>, where <code>n</code> is an integer, <code>D</code> is day, <code>M</code> is month, and <code>Y</code> is year. e.g., <code>8D</code> = 8-day</li>
</ul>
</li>
<li><code>metadata</code>: Metadata about the dataset<ul>
<li><code>title</code>: Title of the dataset</li>
<li><code>version</code>: Version of the dataset</li>
<li><code>doi</code>: DOI of the dataset - highly recommended</li>
</ul>
</li>
</ul>
<h2 id="configurations-for-supported-protocols">Configurations for supported protocols<a class="headerlink" href="#configurations-for-supported-protocols" title="Permanent link">&para;</a></h2>
<p>The sections below show the configuration for supported protocols including the conditional required fields.</p>
<h3 id="httphttpsftps3">HTTP/HTTPS/FTP/S3<a class="headerlink" href="#httphttpsftps3" title="Permanent link">&para;</a></h3>
<p>For file-based sources, <code>fsspec</code> is used to download the data. Ensure that you pass the appropriate <code>fsspec</code> options in the <code>storage_options</code> field.
I've given an example for an FTP source below but the same principle would apply for S3 for example. At the moment, sessions + cookies are not supported. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">fsspec_data_source_key</span><span class="p">:</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="c1"># url must have the following: start with &#39;filecache::&#39;, </span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">filecache::ftp://example.com/variable/product/remote_fname_{t:%Y%m%d}.nc</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="c1"># fsspec is used to download files, so any fsspec options can be passed</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">storage_options</span><span class="p">:</span><span class="w">  </span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">        </span><span class="c1"># items given at the main level are used for &#39;filecache&#39;, </span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">        </span><span class="c1"># while subsequent protocols have to be specified (see &#39;ftp&#39; below)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span><span class="nt">cache_storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../data/sst/{t:%Y}/</span><span class="w">  </span><span class="c1"># only the folder should be given</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="nt">same_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># in this case &#39;remote_fname_{t:%Y%m%d}.nc&#39;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">        </span><span class="nt">ftp</span><span class="p">:</span><span class="w">  </span><span class="c1"># an example of ftp options</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">            </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myusername</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">            </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypassword</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">  </span><span class="c1"># optional</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">        </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Copy</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">website&#39;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;v1.0&#39;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">        </span><span class="nt">doi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://doi.org/10....</span><span class="w">  </span><span class="c1"># much easier later</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span><span class="nt">time</span><span class="p">:</span><span class="w">  </span><span class="c1"># to specify the time range of the data</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">        </span><span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1980-01-01</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">        </span><span class="nt">end</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2024-01-01</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">        </span><span class="nt">freq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1D</span><span class="w">  </span><span class="c1"># the frequency of the data (&#39;8D&#39; = 8-day, etc.)</span>
</code></pre></div>
<h3 id="thredds-datasets">THREDDS datasets<a class="headerlink" href="#thredds-datasets" title="Permanent link">&para;</a></h3>
<p>For both thredds and CMEMS datasets, the same approach is used. The data is loaded using xarray, and the nearest time step to the requested time is selected. 
This means that if the requested time is not available, the nearest available time step is selected (e.g., 1990-01-01 requested, but only 1997-09-01 is available).</p>
<p>For THREDDS datasets that can be accessed through the <code>thredds::</code> protocol:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">thredds_based_data_source_key</span><span class="p">:</span><span class="w">  </span><span class="c1"># in the output dictionary</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="c1"># the url must contain `thredds::`, to be recognized as a THREDDS dataset</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://rsg.pml.ac.uk/thredds/dodsC/CCI_ALL-v6.0-8DAY</span><span class="w">  </span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="nt">storage_options</span><span class="p">:</span><span class="w">  </span><span class="c1"># we keep the same nomenclature as fsspec (a bit clunky)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">        </span><span class="c1"># for the local storage, file path AND name are required for thredds</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">        </span><span class="nt">cache_storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../data/variable/product/{t:%Y}/filename_{t:%Y%m%d}.nc</span><span class="w">  </span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="nt">time</span><span class="p">:</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1997-09-01</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="nt">end</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2024-01-01</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="nt">freq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8D</span>
</code></pre></div>
<h3 id="cmems-datasets">CMEMS datasets<a class="headerlink" href="#cmems-datasets" title="Permanent link">&para;</a></h3>
<p>For CMEMS (Copernicus Marine Service) datasets:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">cmems_data_source_key</span><span class="p">:</span><span class="w">  </span><span class="c1"># will be used as the key in the output dictionary</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="c1"># only pass the dataset ID as copied from the CMEMS website </span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="c1"># if not recognized as a url, then assume it&#39;s a CMEMS dataset ID</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;copernicusmarine_dataset_id&gt;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">        </span><span class="nt">doi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://doi.org/10....</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="nt">storage_options</span><span class="p">:</span><span class="w">  </span><span class="c1"># to be consistent with fsspec nomenclature</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">        </span><span class="c1"># for the local storage, file path AND name are required for CMEMS</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">        </span><span class="nt">cache_storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../data/variable/product/{t:%Y}/filename_{t:%Y%m%d}.nc</span><span class="w">  </span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="nt">variables</span><span class="p">:</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">        </span><span class="nt">variable_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output_name</span><span class="w">  </span><span class="c1"># currently variable is not renamed</span>
</code></pre></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../.." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../oceansoda-sources/" class="btn btn-neutral float-right" title="OceanSODA-ETHZv2 sources">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../.." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../oceansoda-sources/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
